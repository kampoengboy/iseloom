<div class="container" style="background-color:white">
    <h3 class="text-center">Scoreboard <%=contest.name%></h3>
    <h4 id="clock" class="text-center"></h4>
    <table class="table table-bordered table-hover table-striped">
        <thead>
            <th>#</th>
            <th>Univ</th>
            <th>Name</th>
            <th>Solved</th>
            <th>Score</th>
            <% _.each(problems, function(problem) { %>
                <th>
                <% if(session.authenticated) { %>
                    <a href="/problem/preview?prob=<%=problem.valName%>&idc=<%=contest.id%>"><%=problem.valName%></a>
                <% } else {%>
                    <%=problem.valName%>
                <% } %>
                </th>
            <% }) %>
        </thead>
        <tbody>
            <% if(users.length > 0) { %>
           <% var idx = 1 %>
                  <% _.each(users, function(user){%>
                      <tr>
                          <td><%=idx%></td>
                          <% var elPos = universities.map(function(x) {return x.id; }).indexOf(user.id_user.university); %>
                          <td><%=universities[elPos].name%></td>
                          <td><%=user.id_user.name%></td>
                          <td><%=user.solve%></td>
                          <td><%=user.score%></td>
                          <% _.each(problems, function(problem) { %>
                               <% var res = false; %>
                               <% var tried = 0; %>
                               <% var amount = 0; %>
                               <% for(var i=0;i<submissions.length;i++) {%>
                                  <% if(submissions[i].id_user.id==user.id_user.id && submissions[i].id_problem.id==problem.id && !res) { %>
                                      <% tried = tried + 1 %>
                                       <% for(var j=0;j<submissions[i].output.length;j++) { %>
                                            <% if(submissions[i].output[j].result==1) { %>
                                                <% amount = amount+1; %>
                                            <% } %>
                                       <% } %>
                                       <% if(amount==submissions[i].output.length) { %>  
                                          <% res = true; %>
                                          <% break; %>
                                       <% } %>
                                  <% } %>
                               <% } %>
                              <% if(!tried) { %>
                               <td></td>
                              <% } else { %>
                                <% if(res) { %>
                                   <td style="background-color:#00FF33" class="text-right"><%=tried %></td>
                                <% } else {%>
                                   <td style="background-color:#FF0000; color:white;" class="text-right"><%=tried %></td>
                                <% } %>
                              <% } %>
                          <% }) %>
                      </tr>
                      <% idx++ %>
                  <%})%>
            <% } %>
        </tbody>
    </table>
</div>
<script>
    var d = new Date('<%=contest.datetimeclose%>');
    var clock_div_name = '#clock';
    $(clock_div_name).countdown(d).on('update.countdown', function(event) {
        $(this).html(event.strftime('%D days %H:%M:%S'));
     }).on('finish.countdown', function(event) {
      $(this).html('Contest has done.')
    });
</script>